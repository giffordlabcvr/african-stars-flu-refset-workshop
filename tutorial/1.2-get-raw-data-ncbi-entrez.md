# Step 1: Get a raw dataset (browser demo)

## 1.2 Command line interface (CLI)-based approach: NCBI Nucleotide

0. Install EDirect (macOS/Linux/WSL)

Script (official):

```
sh -c "$(curl -fsSL https://ftp.ncbi.nlm.nih.gov/entrez/entrezdirect/install-edirect.sh)"
export PATH="$PATH:$HOME/edirect"
```

### 1. Download by Publication Date (PDAT) → FASTA (and GBK)

```
# Raw FASTA for Alphainfluenzavirus (flu A), H3N2, South Africa, published 2018–2025

esearch -db nucleotide -query \
'"Alphainfluenzavirus"[Organism] AND H3N2[All Fields] AND "South Africa"[All Fields] AND ("2018/01/01"[PDAT] : "2025/12/31"[PDAT])' \
| efetch -format fasta > sa_h3n2_pdat_2018_2025.fasta

# (Optional) Also grab GenBank flatfiles with /source qualifiers

esearch -db nucleotide -query \
'"Alphainfluenzavirus"[Organism] AND H3N2[All Fields] AND "South Africa"[All Fields] AND ("2018/01/01"[PDAT] : "2025/12/31"[PDAT])' \
| efetch -format gbc > sa_h3n2_pdat_2018_2025.gbk

# Quick sanity check

grep -c '^>' sa_h3n2_pdat_2018_2025.fasta
```

### 2. (Optional) Build a simple metadata table from GBK

```
xtract -input sa_h3n2_pdat_2018_2025.gbk -pattern INSDSeq \
  -element INSDSeq_accession-version INSDSeq_organism INSDSeq_length \
  -block INSDQualifier -if INSDQualifier_name -equals collection_date -element INSDQualifier_value \
  -block INSDQualifier -if INSDQualifier_name -equals geo_loc_name     -element INSDQualifier_value \
  -block INSDQualifier -if INSDQualifier_name -equals segment          -element INSDQualifier_value \
  -block INSDQualifier -if INSDQualifier_name -equals serotype         -element INSDQualifier_value \
  -block INSDQualifier -if INSDQualifier_name -equals host             -element INSDQualifier_value \
  > metadata_raw.tsv
# Columns: accession  organism  length  collection_date  geo_loc_name  segment  serotype  host
```

### 3. (Optional “collection date” filtering locally)

Because `[Collection Date]` isn't indexed, filter the GBK-derived table yourself, then fetch exactly those accessions.

```
# Keep 2018--2025 by collection year\
awk -F'\t' 'NR>1 && $NF>=2018 && $NF<=2025 {print $1}' metadata.tsv > keep_ids.txt

# Re-fetch FASTA for only those accessions\
cat keep_ids.txt | epost -db nucleotide | efetch -format fasta > sa_h3n2_cd_2018_2025.fasta
```

### 4. Hand-off to your Nextclade → augur step Send to → File → FASTA.

-   Use **Nextclade** on `sa_h3n2_pdat_2018_2025.fasta` (or the collection-date-filtered FASTA).
-   Then proceed with your `augur index` / `augur filter` subsampling (clade × year × month).
       
* * * * *



